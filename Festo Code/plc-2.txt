
controlPos0
controlPos1
controlPos2
linearMotor
rotaryMotor
gripper
isSliderStateBit
slider
iRotaryMotionComplete
iLinearMotionComplete
prevFlag
flag
--------------------------------------------------------------------
#include <bur/plctypes.h>

#ifdef _DEFAULT_INCLUDES
#include <AsDefault.h>
#endif

void activateLinearMotor(){
	linearMotor=1;
	linearMotor=0;
}

void activateRotaryMotor(){
	rotaryMotor=1;
	rotaryMotor=0;
}

void gripperOpen(){
	gripper=0;
}

void gripperClose()
{
	if(isSliderStateOpen()==1){
		gripper=1;
	}
}

void sliderExtend(){
	if(isSliderStateClose()==1){
		slider=1;
	}
}

void sliderClose(){
	if(isSliderStateOpen()==1){
		slider=0;
	}
}

int isSliderStateOpen(){
    return isSliderStateBit==0?1:0;
}

int isSliderStateClose(){
	return isSliderStateBit==1?1:0;
}

int isMotionComplete(){
	if(iRotaryMotionComplete==1 && iLinearMotionComplete==1){
		return 1;
	}
	else{
		return 0;
	}
}

void gotoPosSingleAxis(int bitSeq,int isLinear){
	int bit =0; int i=0;
	for(i=0;i<3;i++){
		bit=(bitSeq && (1<<i))!=0;
		if(i==0){
			controlPos0=bit;
		}
		if(i==1){
			controlPos1=bit;
		}
		if(i==2){
			controlPos2=bit;
		}
		if(isLinear){
			activateLinearMotor();
		}
		else{
			activateRotaryMotor();
		}
	}
}

void gotoPosDoubleAxis(int linearBitSeq, int rotyaryBitSeq){
	gotoPosSingleAxis(linearBitSeq,1);
	gotoPosSingleAxis(rotyaryBitSeq,0);
}


void _INIT ProgramInit(void)
{
	gotoPosSingleAxis(7,0);
	gotoPosSingleAxis(0,1);
}

void _CYCLIC ProgramCyclic(void)
{
	//homing complete
	if(flag==1){
		if(flag!=prevFlag){
			gotoPosDoubleAxis(3,7);
			prevFlag=flag;
		}
		if(flag==prevFlag && isMotionComplete()==1){
			flag=2;
		}
	}

	//source position open slider close
	if(flag==2){
		if(flag!=prevFlag){
			sliderExtend();
			prevFlag=flag;
		}
		if(flag==prevFlag && isSliderStateOpen()==1){
			flag=3;
		}
	}

	//source position slider open
	if(flag==3){
		if(flag!=prevFlag){
			gripperClose();
			prevFlag=flag;
		}
		if(flag==prevFlag){
			flag=4;
		}
	}

	//object grabbed
	if(flag==4){
		if(flag!=prevFlag){
			gotoPosSingleAxis(3,4);
			prevFlag=flag;
		}
		if(flag==prevFlag && isMotionComplete()==1){
			flag=5;
		}
	}

	//object taken from source and slider open
	if(flag==5){
		if(flag!=prevFlag){
			sliderClose();
			prevFlag=flag;
		}
		if(flag==prevFlag && isSliderStateClose()==1){
			flag=6;
		}
	}

	//slider closed with object 
	if(flag==6){
		if(flag!=prevFlag){
			gotoPosDoubleAxis(3,4);
			prevFlag=flag;
		}
		if(flag==prevFlag && isMotionComplete()==1){
			flag=7;
		}
	}

	// reached to destination
	if(flag==7){
		if(flag!=prevFlag){
			sliderExtend();
			prevFlag=flag;
		}
		if(flag==prevFlag && isSliderStateOpen()==1){
			flag=8;
		}
	}

	//slider open toward destination
	if(flag==8){
		if(flag!=prevFlag){
			gripperOpen();
			prevFlag=flag;
		}
		if(flag==prevFlag){
			flag=9;
		}
	}

}

void _EXIT ProgramExit(void)
{

}

